---
layout: post

title: "Python的多线程与多进程"
date: 2017-03-07 21:26:54 +0800

categories: python
tags: [python, 多线程]
---

1. 多进程

    ```python
    def run_something(name):
        print("这里使用 %s进程 处理 %s." % (os.getpid(), name))

    if __name__ == '__main__':
        print("当前进程是: %s" % os.getpid())
        pro = Process(target=run_something, args=('Hello',))
        pro.start()
        pro.join()
        print("子进程结束.")
    ```
    运行结果:
    ```
    当前进程是: 9304
    这里使用 9309进程 处理 Hello.
    子进程结束.
    ```

    `子进程`, 示例:

    ```python
    if __name__ == '__main__':
        print("$nslookup www.so.com:")
        sre = subprocess.call(['nslookup', 'www.so.com'])
        print("Exit ", sre)
    ```
    运行结果:
    ```text
    $nslookup www.so.com:
    Server:		127.0.1.1
    Address:	127.0.1.1#53

    Non-authoritative answer:
    www.so.com	canonical name = so.qh-lb.com.
    Name:	so.qh-lb.com
    Address: 125.88.193.243

    Exit  0
    ```
    `进程通信`, 示例:
    ```python
    def os_write(qu):
        print("当前 write 进程是: %s" % os.getpid())
        for i in range(5):
            print("通道装载数据: %d" % i)
            qu.put(i)
            time.sleep(random.random() * 2)


    def os_read(qu):
        print("当前 read 进程是: %s" % os.getpid())
        while True:
            print("从通道中获取: ", qu.get(True))


    if __name__ == '__main__':
        qu = Queue()
        pw = Process(target=os_write, args=(qu,))
        pr = Process(target=os_read, args=(qu,))
        pw.start()
        pr.start()
        pw.join()
        if qu.empty():
            pr.terminate()
        print("进程结束")
    ```
    运行结果:
    ```
    当前 write 进程是: 12670
    通道装载数据: 0
    当前 read 进程是: 12671
    从通道中获取:  0
    通道装载数据: 1
    从通道中获取:  1
    通道装载数据: 2
    从通道中获取:  2
    通道装载数据: 3
    从通道中获取:  3
    通道装载数据: 4
    从通道中获取:  4
    进程结束
    ```
    >- [廖雪峰 python 教程 - 多进程](http://www.liaoxuefeng.com/wiki/0014316089557264a6b348958f449949df42a6d3a2e542c000/001431927781401bb47ccf187b24c3b955157bb12c5882d000)
    >- [Python Queues](https://docs.python.org/3.4/library/asyncio-queue.html)

1. 多线程

    ```python
    def run_loop():
        print("当前线程是: %s" % threading.current_thread().name)
        for i in range(6):
            print("线程 %s 处理 %d" % (threading.current_thread().name, i))
            time.sleep(random.random() * 2)
        print("线程 %s 结束." % threading.current_thread().name)


    if __name__ == '__main__':
        print("当前线程是: %s" % threading.current_thread().name)
        td = threading.Thread(target=run_loop, name="LoopThread")
        td.start()
        td.join()
        print("线程 %s 结束." % threading.current_thread().name)
    ```
    运行结果:
    ```
    当前线程是: MainThread
    当前线程是: LoopThread
    线程 LoopThread 处理 0
    线程 LoopThread 处理 1
    线程 LoopThread 处理 2
    线程 LoopThread 处理 3
    线程 LoopThread 处理 4
    线程 LoopThread 处理 5
    线程 LoopThread 结束.
    线程 MainThread 结束.
    ```

    > 多线程与多进程的区别 [^1]
    >> **多线程** 和 **多进程** 最大的不同在于， **多进程** 中，同一个变量，各自有一份拷贝存在于每个进程中，互不影响，而多线程中，所有变量都由所有线程共享

---
### 更多阅读
- [进程与线程的一个简单解释](http://www.ruanyifeng.com/blog/2013/04/processes_and_threads.html)
- [进程和线程](http://www.liaoxuefeng.com/wiki/0014316089557264a6b348958f449949df42a6d3a2e542c000/0014319272686365ec7ceaeca33428c914edf8f70cca383000)
- [我是一个线程](http://mp.weixin.qq.com/s?__biz=MjM5NzA1MTcyMA%3Cmark%3E&mid=403498894&idx=2&sn=219c1a6001b5bb7e6bdc7963b1af8450)

---
### 索引

[^1]: [廖雪峰 python 教程 - 多线程](http://www.liaoxuefeng.com/wiki/0014316089557264a6b348958f449949df42a6d3a2e542c000/00143192823818768cd506abbc94eb5916192364506fa5d000)
